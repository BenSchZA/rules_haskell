jobs:
- job: Windows
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - bash: |
      curl -LO https://github.com/bazelbuild/bazel/releases/download/0.20.0/bazel-0.20.0-windows-x86_64.exe
      mv bazel-*.exe bazel.exe
      mkdir /c/bazel
      mv bazel.exe /c/bazel
      gcc --version
      echo $(which gcc)
      echo $(which bash)
      find "/c/program files/git"
    displayName: 'Install Bazel'
  - script:
      C:/bazel/bazel.exe build --compiler=mingw-gcc -s --verbose_failures "//tests/binary-simple"
  - bash: |
      # Simple haskell binary
      export MSYS_NO_PATHCONV=1
      export MSYS2_ARG_CONV_EXCL="*"
      /c/bazel/bazel.exe build --compiler=mingw-gcc -s --verbose_failures "//tests/binary-simple"
    displayName: 'Run Bazel'
